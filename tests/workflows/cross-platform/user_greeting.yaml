name: "user-greeting"
description: "Greet a user and capture the message"

parameters:
  username:
    value: "World"
  greeting_count:
    type: int
    value: 42
  is_formal:
    type: bool
    value: true

steps:
  create_greeting:
    name: "Create Greeting"
    type: script::python
    script: |
      import sys
      formal = "{{ inputs.formal }}" == "true"
      count = int("{{ inputs.count }}")
      user = "{{ inputs.user }}"

      if formal:
          print(f"Good day, {user}! This is greeting number {count}.")
          print(f"GREETING=Good day, {user}!")
      else:
          print(f"Hey {user}! Greeting #{count}")
          print(f"GREETING=Hey {user}!")
    inputs:
      user:
        ref: parameters.username
      count:
        ref: parameters.greeting_count
      formal:
        ref: parameters.is_formal
    outputs:
      message:
        pattern: "GREETING=(.*)"

  confirm_greeting:
    name: "Confirm Greeting"
    type: script::python
    script: |
      msg = "{{ inputs.msg }}"
      print(f"Message created: {msg}")
      print("CONFIRMED=true")
    inputs:
      msg:
        ref: steps.create_greeting.outputs.message
    outputs:
      status:
        pattern: "CONFIRMED=(.*)"

results:
  greeting:
    ref: steps.create_greeting.outputs.message
  confirmed:
    ref: steps.confirm_greeting.outputs.status
